<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Evident Acquisition Analyser</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .tooltip {
            position: relative;
            display: inline-block;
            border-bottom: 1px dotted black;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 300px;
            background-color: #555;
            color: #fff;
            text-align: left;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -150px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body class="bg-gray-100 p-8">
    <div class="container mx-auto bg-white p-8 rounded-lg shadow-lg">
        <h1 class="text-3xl font-bold mb-6 text-center">Evident Acquisition Analyser</h1>
        
        <div class="mb-6">
            <h2 class="text-xl font-semibold mb-4">üì§ Upload Data</h2>
            <input type="file" id="csvFileInput" accept=".csv" class="w-full p-2 border rounded">
            <p class="text-sm text-gray-600 mt-2">
                CSV should include columns: 
                Company Name, ARR ($), Revenue Growth Rate (%), NRR (%), GRR (%), 
                Customer Concentration (%), CAC ($), LTV ($), Market Size (SAM) ($), 
                Vertical, Years in Business, Market Position (1-10), 
                Scalability (1-10), Technology Strength (1-10), 
                Management Team (1-10), Strategic Synergy (1-10), 
                Exit Potential (1-10)
            </p>
        </div>

        <div id="dataPreview" class="mb-6 hidden">
            <h2 class="text-xl font-semibold mb-4">üìä Data Preview</h2>
            <div id="previewTable" class="overflow-x-auto"></div>
        </div>

        <div id="qualitativeFactors" class="hidden mt-6">
            <h2 class="text-xl font-semibold mb-4">üîç Qualitative Ranking Factor Weights</h2>
            <p class="text-sm text-gray-600 mb-4">
                These sliders adjust the relative importance of each qualitative factor in the overall scoring.
            </p>
            <div class="space-y-4">
                <div>
                    <label for="marketPositionWeight" class="block mb-2">
                        Market Position & Differentiation Weight
                        <span class="text-sm text-gray-600">(Competitive landscape, unique value proposition)</span>
                    </label>
                    <input type="range" id="marketPositionWeight" min="1" max="10" value="5" class="w-full">
                    <span id="marketPositionWeightValue" class="text-sm text-gray-600">5</span>
                </div>

                <div>
                    <label for="scalabilityWeight" class="block mb-2">
                        Scalability & Growth Potential Weight
                        <span class="text-sm text-gray-600">(Expansion opportunities, infrastructure readiness)</span>
                    </label>
                    <input type="range" id="scalabilityWeight" min="1" max="10" value="5" class="w-full">
                    <span id="scalabilityWeightValue" class="text-sm text-gray-600">5</span>
                </div>

                <div>
                    <label for="technologyStrengthWeight" class="block mb-2">
                        Technology Strength & Innovation Weight
                        <span class="text-sm text-gray-600">(Product architecture, technological uniqueness)</span>
                    </label>
                    <input type="range" id="technologyStrengthWeight" min="1" max="10" value="5" class="w-full">
                    <span id="technologyStrengthWeightValue" class="text-sm text-gray-600">5</span>
                </div>

                <div>
                    <label for="managementTeamWeight" class="block mb-2">
                        Management Team Quality Weight
                        <span class="text-sm text-gray-600">(Team experience, track record)</span>
                    </label>
                    <input type="range" id="managementTeamWeight" min="1" max="10" value="5" class="w-full">
                    <span id="managementTeamWeightValue" class="text-sm text-gray-600">5</span>
                </div>

                <div>
                    <label for="strategicSynergyWeight" class="block mb-2">
                        Strategic Synergy Potential Weight
                        <span class="text-sm text-gray-600">(Integration capabilities, cross-selling opportunities)</span>
                    </label>
                    <input type="range" id="strategicSynergyWeight" min="1" max="10" value="5" class="w-full">
                    <span id="strategicSynergyWeightValue" class="text-sm text-gray-600">5</span>
                </div>

                <div>
                    <label for="exitPotentialWeight" class="block mb-2">
                        Exit & Value Appreciation Weight
                        <span class="text-sm text-gray-600">(Future sale or IPO likelihood)</span>
                    </label>
                    <input type="range" id="exitPotentialWeight" min="1" max="10" value="5" class="w-full">
                    <span id="exitPotentialWeightValue" class="text-sm text-gray-600">5</span>
                </div>
            </div>
        </div>

        <div id="valuationSection" class="hidden mt-6">
            <h2 class="text-xl font-semibold mb-4">üîç Valuation Methodology</h2>
            <div class="bg-blue-50 p-4 rounded">
                <p class="mb-4">Our comprehensive valuation methodology integrates multiple dimensions of company assessment:</p>
                
                <div class="space-y-4">
                    <div>
                        <h3 class="font-semibold">1. ARR Score (Annual Recurring Revenue)</h3>
                        <p class="text-sm text-gray-600">
                            Evaluates the company's revenue stability and scale. Discrete banding approach ensures fair representation across different company sizes, with nuanced scoring from 1-10.
                        </p>
                    </div>

                    <div>
                        <h3 class="font-semibold">2. Growth Score</h3>
                        <p class="text-sm text-gray-600">
                            Measures the company's year-over-year revenue growth rate. Non-linear scoring that better differentiates growth stages and rewards high-growth companies.
                        </p>
                    </div>

                    <div>
                        <h3 class="font-semibold">3. Retention Score</h3>
                        <p class="text-sm text-gray-600">
                            Combines Net Revenue Retention (NRR) and Gross Revenue Retention (GRR) to assess customer and revenue stability. Base score of 7 for 100% NRR, with additional points for over-performance in NRR and GRR.
                        </p>
                    </div>

                    <div>
                        <h3 class="font-semibold">4. Market Score</h3>
                        <p class="text-sm text-gray-600">
                            Evaluates the Total vs Serviceable vs Obtainable Market (TAM>SAM>SOM) with a logarithmic scaling approach. Incorporates vertical-specific multipliers to account for market potential and industry dynamics.
                        </p>
                    </div>

                    <div>
                        <h3 class="font-semibold">5. Qualitative Factors</h3>
                        <p class="text-sm text-gray-600">
                            Incorporates nuanced assessments of market positioning, scalability, technology strength, management quality, strategic potential, and exit opportunities. User-adjustable weights allow for flexible, context-aware analysis.
                        </p>
                    </div>

                    <div>
                        <h3 class="font-semibold">Composite Scoring</h3>
                        <p class="text-sm text-gray-600">
                            Final valuation combines weighted scores:
                            <ul class="list-disc pl-5 text-xs">
                                <li>ARR Score: 25%</li>
                                <li>Growth Score: 20%</li>
                                <li>Retention Score: 15%</li>
                                <li>Market Score: 20%</li>
                                <li>Weighted Qualitative Factors: 20%</li>
                            </ul>
                        </p>
                    </div>
                </div>
            </div>

            <div class="mt-6">
                <button id="calculateButton" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                    Calculate Company Rankings
                </button>
            </div>
        </div>

        <div id="rankingResults" class="mt-6 hidden">
            <h2 class="text-xl font-semibold mb-4">üèÜ Company Rankings</h2>
            <div id="rankedCompaniesTable" class="overflow-x-auto"></div>
        </div>
    </div>

    <script>
        // Slider value display
        ['marketPositionWeight', 'scalabilityWeight', 'technologyStrengthWeight', 
         'managementTeamWeight', 'strategicSynergyWeight', 'exitPotentialWeight'].forEach(id => {
            const slider = document.getElementById(id);
            const valueSpan = document.getElementById(id + 'Value');
            slider.addEventListener('input', () => {
                valueSpan.textContent = slider.value;
            });
        });

        // File upload handler
        document.getElementById('csvFileInput').addEventListener('change', handleFileUpload);
        
        function handleFileUpload(event) {
            const file = event.target.files[0];
            Papa.parse(file, {
                header: true,
                complete: function(results) {
                    // Filter out any empty rows
                    const cleanedData = results.data.filter(row => 
                        Object.values(row).some(val => val !== '')
                    );
                    displayDataPreview(cleanedData);
                    document.getElementById('dataPreview').classList.remove('hidden');
                    document.getElementById('valuationSection').classList.remove('hidden');
                    document.getElementById('qualitativeFactors').classList.remove('hidden');
                }
            });
        }

        function displayDataPreview(data) {
            const previewTable = document.getElementById('previewTable');
            const table = document.createElement('table');
            table.className = 'w-full border-collapse border';
            
            // Create header
            const headerRow = table.insertRow();
            Object.keys(data[0]).forEach(key => {
                const th = document.createElement('th');
                th.textContent = key;
                th.className = 'border p-2 bg-gray-200';
                headerRow.appendChild(th);
            });

            // Add first few rows
            data.slice(0, 5).forEach(row => {
                const tr = table.insertRow();
                Object.values(row).forEach(value => {
                    const td = tr.insertCell();
                    td.textContent = value;
                    td.className = 'border p-2';
                });
            });

            previewTable.innerHTML = '';
            previewTable.appendChild(table);

            // Attach calculate button listener
            document.getElementById('calculateButton').addEventListener('click', () => calculateRankings(data));
        }

        function calculateRankings(companies) {
            // Collect qualitative factor weights
            const qualitativeWeights = {
                marketPosition: document.getElementById('marketPositionWeight').value / 10,
                scalability: document.getElementById('scalabilityWeight').value / 10,
                technologyStrength: document.getElementById('technologyStrengthWeight').value / 10,
                managementTeam: document.getElementById('managementTeamWeight').value / 10,
                strategicSynergy: document.getElementById('strategicSynergyWeight').value / 10,
                exitPotential: document.getElementById('exitPotentialWeight').value / 10
            };

            // Valuation calculation logic
            const scoredCompanies = companies.map(company => {
                // Quantitative Scoring
                const arrScore = calculateARRScore(company);
                const growthScore = calculateGrowthScore(company);
                const retentionScore = calculateRetentionScore(company);
                const marketScore = calculateMarketScore(company);
                
                // Qualitative Scoring (using predefined scores from CSV)
                const qualitativeScores = {
                    marketPosition: parseFloat(company['Market Position (1-10)']) || 5,
                    scalability: parseFloat(company['Scalability (1-10)']) || 5,
                    technologyStrength: parseFloat(company['Technology Strength (1-10)']) || 5,
                    managementTeam: parseFloat(company['Management Team (1-10)']) || 5,
                    strategicSynergy: parseFloat(company['Strategic Synergy (1-10)']) || 5,
                    exitPotential: parseFloat(company['Exit Potential (1-10)']) || 5
                };

                // Weighted Qualitative Score
                const weightedQualitativeScore = Object.keys(qualitativeScores).reduce((total, key) => {
                    return total + (qualitativeScores[key] * qualitativeWeights[key]);
                }, 0) / Object.keys(qualitativeScores).length;
                
                // Composite Score (now including weighted qualitative factors)
                const compositeScore = (
                    arrScore * 0.25 + 
                    growthScore * 0.2 + 
                    retentionScore * 0.15 + 
                    marketScore * 0.2 + 
                    weightedQualitativeScore * 0.2
                );

                return {
                    ...company,
                    arrScore,
                    growthScore,
                    retentionScore,
                    marketScore,
                    qualitativeScores,
                    weightedQualitativeScore,
                    compositeScore,
                    rankColor: getColorForScore(compositeScore)
                };
            });

            // Sort companies by composite score
            const rankedCompanies = scoredCompanies.sort((a, b) => b.compositeScore - a.compositeScore);
            displayRankings(rankedCompanies);
        }

        function calculateARRScore(company) {
            const arr = parseFloat(company['ARR ($)'].replace(/[,$]/g, '')) || 0;
            // More nuanced ARR scoring
            if (arr < 500000) return 1;  // Very small
            if (arr < 2000000) return 3;  // Small
            if (arr < 5000000) return 5;  // Mid-market
            if (arr < 10000000) return 7;  // Growing
            if (arr < 25000000) return 8;  // Substantial
            if (arr < 50000000) return 9;  // Large
            return 10;  // Enterprise-level
        }

        function calculateGrowthScore(company) {
            const growthRate = parseFloat(company['Revenue Growth Rate (%)']) || 0;
            // More sophisticated growth scoring
            if (growthRate < 10) return 1;  // Low/No growth
            if (growthRate < 25) return 3;  // Modest growth
            if (growthRate < 50) return 5;  // Good growth
            if (growthRate < 75) return 7;  // Strong growth
            if (growthRate < 100) return 9;  // Exceptional growth
            return 10;  // Hyper-growth
        }

        function calculateRetentionScore(company) {
            const nrr = parseFloat(company['NRR (%)']) || 0;
            const grr = parseFloat(company['GRR (%)']) || 0;
            // Weighted retention score between 1-10
            // NRR 100% = Base 7 points
            // Additional points for NRR over 100% and GRR
            const normalizedScore = Math.min(10, Math.max(1, 
                7 + (Math.min(3, (nrr - 100) / 20)) + 
                (grr / 100)
            ));
            return normalizedScore;
        }

        function calculateMarketScore(company) {
            const sam = parseFloat(company['Market Size (SAM) ($)'].replace(/[,$]/g, '')) || 0;
            const verticalMultiplier = getVerticalMultiplier(company.Vertical || 'default');
            
            // Normalize market size score between 1-10
            // 1 = Below $10M
            // 10 = $1B+
            const baseScore = Math.min(10, Math.max(1, Math.log10(sam / 10000000) * 3 + 1));
            
            // Apply vertical multiplier (slight boost, not exceeding 10)
            return Math.min(10, baseScore * verticalMultiplier);
        }

        function getVerticalMultiplier(vertical) {
            const verticalScores = {
                'fintech': 1.2,
                'healthcare': 1.3,
                'enterprise': 1.4,
                'marketing': 1.1,
                'legal': 1.1,
                'education': 1.0,
                'cybersecurity': 1.3,
                'agriculture': 0.9,
                'analytics': 1.2,
                'default': 1.0
            };
            return verticalScores[vertical.toLowerCase()] || verticalScores['default'];
        }

        function getColorForScore(score) {
		if (score >= 9) return 'bg-green-100';
		if (score >= 8) return 'bg-green-200';
            	if (score >= 7) return 'bg-green-300';
           	if (score >= 6) return 'bg-yellow-200';
           	if (score >= 5) return 'bg-orange-200';
            return 'bg-red-200';
        }

        function displayRankings(rankedCompanies) {
            const resultsDiv = document.getElementById('rankingResults');
            const table = document.createElement('table');
            table.className = 'w-full border-collapse border';

            // Headers
            const headers = [
                'Rank', 'Company', 'ARR Score', 'Growth Score', 
                'Retention Score', 'Market Score', 'Qualitative Score', 'Composite Score'
            ];
            const headerRow = table.insertRow();
            headers.forEach(header => {
                const th = document.createElement('th');
                th.textContent = header;
                th.className = 'border p-2 bg-gray-200';
                headerRow.appendChild(th);
            });

            // Ranked companies
            rankedCompanies.forEach((company, index) => {
                const tr = table.insertRow();
                tr.className = company.rankColor;

                // Rank
                const rankCell = tr.insertCell();
                rankCell.textContent = index + 1;
                rankCell.className = 'border p-2 font-bold';

                // Company Name
                const nameCell = tr.insertCell();
                nameCell.textContent = company['Company Name'];
                nameCell.className = 'border p-2';

                // Scores
                [
                    'arrScore', 
                    'growthScore', 
                    'retentionScore', 
                    'marketScore', 
                    'weightedQualitativeScore',
                    'compositeScore'
                ].forEach(scoreKey => {
                    const cell = tr.insertCell();
                    cell.textContent = company[scoreKey].toFixed(2);
                    cell.className = 'border p-2';
                });
            });

            const resultsContainer = document.getElementById('rankedCompaniesTable');
            resultsContainer.innerHTML = '';
            resultsContainer.appendChild(table);
            resultsDiv.classList.remove('hidden');
        }
    </script>
</body>
</html>
